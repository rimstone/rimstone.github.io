<!DOCTYPE html>
<html lang="en">

<head>
<!--__RIM_REDIRECT__-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">

<title>Client API</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="HandheldFriendly" content="True"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="canonical" href="https://rimstone-lang.com/Client-API.html" />
<style>


body, html {
    font-family: Quicksand,monospace,Helvetica, Arial, sans-serif;
    line-height: 150%;
    font-size:16px;
}

body {
    padding-left:1vw;
    padding-right:1vw;
}
    
.ncode {
    letter-spacing: 0px;
    font-family: monospace;
    font-size:83%;
    display:inline-block;
    max-width:99%;
    min-width:90%;
    margin:0;
    padding:0;
    padding-left:5px;
    padding-top:3px;
    padding-bottom:3px;
    margin-bottom:8px;
    margin-top:8px;
    border: 2px solid #d6d6d6;
    background-color:#f5f7f4;
    white-space:nowrap;
}

.shcode {
    letter-spacing: 0px;
    font-family: monospace;
    font-size:83%;
    display:inline-block;
    max-width:99%;
    min-width:90%;
    margin:0;
    padding:0;
    padding-left:5px;
    padding-top:3px;
    padding-bottom:3px;
    margin-bottom:8px;
    margin-top:8px;
    border: 2px solid #d6d6d6;
    background-color:#f5f7f4;
    white-space:nowrap;
}

.sqlcode {
    letter-spacing: 0px;
    font-family: monospace;
    font-size:83%;
    display:inline-block;
    max-width:99%;
    min-width:90%;
    margin:0;
    padding:0;
    padding-left:5px;
    padding-top:3px;
    padding-bottom:3px;
    margin-bottom:8px;
    margin-top:8px;
    border: 2px solid #d6d6d6;
    background-color:#f5f7f4;
    white-space:nowrap;
}

.htmlcode {
    letter-spacing: 0px;
    font-family: monospace;
    font-size:83%;
    display:inline-block;
    max-width:99%;
    min-width:90%;
    margin:0;
    padding:0;
    padding-left:5px;
    padding-top:3px;
    padding-bottom:3px;
    margin-bottom:8px;
    margin-top:8px;
    border: 2px solid #d6d6d6;
    background-color:#f5f7f4;
    white-space:nowrap;
}

.code {
    letter-spacing: 0px;
    font-family: monospace;
    font-size:83%;
    display:inline-block;
    max-width:99%;
    min-width:90%;
    margin:0;
    padding:0;
    padding-left:5px;
    padding-top:3px;
    padding-bottom:3px;
    margin-bottom:8px;
    margin-top:8px;
    border: 2px solid #d6d6d6;
    background-color:#f5f7f4;
    white-space:nowrap;
}

/*Just like h1 but for pdf conversion it would be indented this way it's not*/
.vhub {
    display: block;
   font-size: 1.6em;
   margin-top: 0.63em;
   margin-bottom: 0.63em;
   margin-left: 0;
   margin-right: 0;
   font-weight: bold;
}

/*Just like h2 but for pdf conversion it would be indented this way it's not*/
.vsub {
    display: block;
   font-size: 1.25em;
   margin-top: 0.53em;
   margin-bottom: 0.53em;
   margin-left: 0;
   margin-right: 0;
   font-weight: bold;
}

ul {
  margin-left: 0.75vw;
  padding-left: 0;
}
li {
  margin-left: 0.75vw;
  padding-left: 0;
}

/* this must be last, as it overrides previous settings, for mobile */
@media (hover: none) {
a {
   display: inline-block;
   padding-top: 3px;
   padding-bottom: 2px;
}
body {
    padding-left:2vw;
    padding-right:2vw;
    letter-spacing: 1px;
}
}

/*The following is for code snippets that are highlighted by 2html vim*/
pre { overflow-x: scroll; margin:0; padding:0; font-family:monospace; }
.Identifier { color: #008b8b; }
.Statement { color: #af5f00; }
.PreProc { color: #5fd7ff; }
.Type { color: #005f00; }
.Comment { color: blue ; }
.Constant { color: #ff00ff; }
/*end of highlighted snippets*/

a {
    text-decoration:none;
    padding-bottom: 0px; 
    color:inherit;
    border-bottom: 2px solid #6cb8f0;
}
a:hover {
    text-decoration: none;
    color:black;
    border-bottom: 1px solid red;
}
/*do not underline links nor should they be active*/
pre a {
    text-decoration:none;
    color:black;
    border-bottom: none;
    pointer-events: none;
    cursor: default;
}


.golfSnippet {display:none;}

ul {
  list-style-type:square;
  list-style-position: outside;
}

</style>


</head>
<body>
<div id="google_translate_element" style='float:right'></div>
<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
<script>
function rim_copy(gt, eid, gc) {
  gt.textContent = eid.textContent;
  gt.select();
  document.execCommand("copy");
  gc.style.visibility="visible"
  setTimeout(()=>{ gc.style.visibility="hidden"; }, 1000);
}
function googleTranslateElementInit() {
   new google.translate.TranslateElement({pageLanguage: 'en'}, 'google_translate_element');
}

</script>

<!--RIMMENU13-->

<!--RIMENDMENU13-->



<!--BEGVDOC90-->
<div class='vhub' style='margin-top:10px;margin-right:20px;text-align:left;background-color:white;'><a href='https://rimstone-lang.com' style='border-bottom:0px'><img src='https://rimstone-lang.com/rimstone.png' style='width:180px;height:auto'/></a></div><div class='vhub' style='margin-top:10px;'>Client API</div><hr/>You can use C API client library to connect to RimStone:<br/>
<ul><li>The API has only a few functions, and the main one is "rim_cli_request()", which makes a call to the service.<br/>
</li><li>There is only a single data type used, which is "rim_cli" and it is used to specify a request and its options, as well as to retrieve results.<br/>
</li><li>There is a single include file ("rcli.h"). <br/>
</li><li>When building your client executable, you can either specify build flags by using the result of "rim -i" (if you have RimStone installed), or use self-contained source files directly.<br/>
</li><li>It is MT-safe, so you can use it in multi-threaded applications, such as to make many requests in parallel.<br/>
</li><li>It comes with messaging API (see <a href='https://rimstone-lang.com/Client-API-and-messaging.html'>Client-API-and-messaging</a>).</li></ul>
See Examples section below for detailed examples.<br/>
<div class="vsub"><a id="Sending a request to RimStone service"></a>Sending a request to RimStone service</div>
The following function is used to make a call using C API:<br/>
<div class='code'  style='position:relative;padding-right:16px;'>
<pre id='code_464' class=notranslate>
<span class="Type">int</span> rim_cli_request (rim_cli *req);</pre>
<span id=rimstone_copied_464 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_464' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_464, code_464, rimstone_copied_464)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
All input and output is contained in a single variable of type "rim_cli", the pointer to which is passed to "rim_cli_request()" function that sends a request to the service. A variable of type "rim_cli" must be initialized to zero before using it (such as with {0} initialization, "memset()" or "calloc()"), or otherwise some of its members may have random values:<br/>
<div class='code'  style='position:relative;padding-right:16px;'>
<pre id='code_467' class=notranslate>
<span class="Comment">// Define and initialize request variable</span>
rim_cli req = {<span class="Constant">0</span>};
<span class="Comment">// You could also do:</span>
<span class="Comment">// memset ((char*)&amp;req, 0, sizeof(rim_cli));</span>
<span class="Statement">.</span>..
<span class="Comment">// Set members of 'req' variable (see below)</span>
<span class="Statement">.</span>..
<span class="Comment">// Make a call</span>
<span class="Type">int</span> result = rim_cli_request (&amp;req);</pre>
<span id=rimstone_copied_467 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_467' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_467, code_467, rimstone_copied_467)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
Type "rim_cli" is defined as (i.e. public members of it):<br/>
<div class='code'  style='position:relative;padding-right:16px;'>
<pre id='code_469' class=notranslate>
<span class="Type">typedef</span> <span class="Type">struct</span> {
    <span class="Type">const</span> <span class="Type">char</span> *server; <span class="Comment">// the IP:port/socket_path to server</span>
    <span class="Type">const</span> <span class="Type">char</span> *req_method; <span class="Comment">// request method</span>
    <span class="Type">const</span> <span class="Type">char</span> *app_path; <span class="Comment">// application path</span>
    <span class="Type">const</span> <span class="Type">char</span> *req; <span class="Comment">// request name</span>
    <span class="Type">const</span> <span class="Type">char</span> *url_params; <span class="Comment">// URL params (path+query string)</span>
    <span class="Type">const</span> <span class="Type">char</span> *content_type; <span class="Comment">// content type</span>
    <span class="Type">int</span> content_len; <span class="Comment">// content len</span>
    <span class="Type">const</span> <span class="Type">char</span> *req_body; <span class="Comment">// request body (i.e. content)</span>
    <span class="Type">char</span> **env; <span class="Comment">// environment to pass to servicde</span>
    <span class="Type">int</span> timeout; <span class="Comment">// timeout for request</span>
    <span class="Type">int</span> req_status; <span class="Comment">// status of request from service</span>
    <span class="Type">int</span> data_len; <span class="Comment">// length of response from service</span>
    <span class="Type">int</span> error_len; <span class="Comment">// length of error from service</span>
    <span class="Type">char</span> *errm; <span class="Comment">// error message when rim_cli_request returns other than RIM_OKAY</span>
    rim_cli_out_hook out_hook; <span class="Comment">// hook to get data output as soon as it arrives</span>
    rim_cli_err_hook err_hook; <span class="Comment">// hook get error output as soon as it arrives</span>
    rim_cli_done_hook done_hook; <span class="Comment">// get all data when request is complete</span>
    <span class="Type">int</span> thread_id; <span class="Comment">// custom ID when executing in a multithreaded fashion</span>
    <span class="Type">volatile</span> <span class="Type">char</span> done; <span class="Comment">// indicator that the request has completed</span>
    <span class="Type">int</span> return_code; <span class="Comment">// the return code from rim_cli_request()</span>
<span class="Statement">}</span> rim_cli;</pre>
<span id=rimstone_copied_469 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_469' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_469, code_469, rimstone_copied_469)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
<br/>
<span style="font-weight:bold;">- Mandatory input</span><br/>
The following members of "rim_cli" type must be supplied in order to make a call to a service:<br/>
<ul><li>"server" represents either a Unix socket or a TCP socket, and is:<br/>
<ul><li>for a Unix socket, a fully qualified name to a Unix socket file used to communicate with the service (use rim_dir() function to obtain it for any RimStone application, see below), or<br/>
</li><li>for a TCP socket, a host name and port name in the form of "&lt;host name&gt;:&lt;port number&gt;", specifying where is the server listening on (for instance "127.0.0.1:2301" if the RimStone service is local and runs on TCP port 2301).</li></ul>
</li><li>"req_method" is a request method, such as "GET", "POST", "PUT", "DELETE" or any other.<br/>
</li><li>"app_path" is an application path (see <a href='https://rimstone-lang.com/request.html'>request</a>). By default it's "/&lt;application name&gt;". <br/>
</li><li>"req" is a request path, i.e. a request name preceded by a forward slash, as in "/&lt;request name&gt;" (see <a href='https://rimstone-lang.com/request.html'>request</a>).</li></ul>
<span style="font-weight:bold;">- Get Unix socket file</span><br/>
To get Unix socket file path, use rim_dir() function, where "type" is the type of RimStone's file or directory, "dir" is the string buffer for the path, "dir_size" is its size, "app" is the application name, and "user" is Operating System user name who owns the application (NULL if your own):<br/>
<div class='code'  style='position:relative;padding-right:16px;'>
<pre id='code_471' class=notranslate>
<span class="Type">size_t</span> rim_dir (<span class="Type">int</span> type, <span class="Type">char</span> *dir, <span class="Type">size_t</span> dir_size, <span class="Type">char</span> *app, <span class="Type">char</span> *user);</pre>
<span id=rimstone_copied_471 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_471' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_471, code_471, rimstone_copied_471)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
Specifically to get the Unix socket file path, use RIM_DIR_SOCKFILE for "type" parameter, and with "app-name" being the application name owned by you:<br/>
<div class='code'  style='position:relative;padding-right:16px;'>
<pre id='code_473' class=notranslate>
<span class="Type">char</span> dir[RIM_MAX_OS_UDIR_LEN];
rim_dir (RIM_DIR_SOCKFILE, dir, <span class="Statement">sizeof</span>(dir), <span class="Constant">&quot;app-name&quot;</span>, <span class="Constant">NULL</span>);</pre>
<span id=rimstone_copied_473 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_473' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_473, code_473, rimstone_copied_473)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
Note that you can use RIM_DIR_USER to get user base directory (where all RimStone files are for a given user), RIM_DIR_APPS to get the directory under which all applications are, RIM_DIR_APP to get the directory under which all application files are, RIM_DIR_FILE to get the file directory, RIM_DIR_TRACE to get the directory where stack trace files are, and RIM_DIR_BLD to get the directory where RimStone application executables are (see <a href='https://rimstone-lang.com/directories.html'>directories</a>). <br/>
<br/>
<span style="font-weight:bold;">- URL parameters</span><br/>
"url_params" is the URL parameters, meaning input parameters (as path segments and query string, see <a href='https://rimstone-lang.com/request.html'>request</a>). URL parameters can be NULL or empty, in which case it is not used.<br/>
<br/>
<span style="font-weight:bold;">- Request body (content)</span><br/>
"req_body" is the request body, which can be any text or binary data. "content_type" is the content type of request body (for instance "application/json" or "image/jpg"). "content_len" is the length of request body in bytes. A request body is sent only if "content_type" and "req_body" are not NULL and not empty, and if "content_len" is greater than zero.<br/>
<br/>
<span style="font-weight:bold;">- Passing environment to service</span><br/>
"env" is any environment variables that should be passed along to the service. You can access those in RimStone via "environment" clause of <a href='https://rimstone-lang.com/get-sys.html'>get-sys</a> statement. This is an array of strings, where name/value pairs are specified one after the other, and which always must end with NULL. For example, if you want to use variable "REMOTE_USER" with value "John" and variable "MY_VARIABLE" with value "8000", then it might look like this:<br/>
<div class='code'  style='position:relative;padding-right:16px;'>
<pre id='code_475' class=notranslate>
<span class="Type">char</span> *env[<span class="Constant">5</span>];
env[<span class="Constant">0</span>] = <span class="Constant">&quot;REMOTE_USER&quot;</span>;
env[<span class="Constant">1</span>] = <span class="Constant">&quot;John&quot;</span>
env[<span class="Constant">2</span>] = <span class="Constant">&quot;MY_VARIABLE&quot;</span>;
env[<span class="Constant">3</span>] = <span class="Constant">&quot;8000&quot;</span>
env[<span class="Constant">4</span>] = <span class="Constant">NULL</span>;</pre>
<span id=rimstone_copied_475 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_475' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_475, code_475, rimstone_copied_475)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
Thus, if you are passing N environment variables to the service, you must size "env" as "char*" array with 2*N+1 elements. <br/>
<br/>
Note that in order to suppress output of HTTP headers from the service, you can include environment variable "RIM_SILENT_HEADER" with value "yes"; to let the service control headers output (either by default, with "-z" option of <a href='https://rimstone-lang.com/mrim.html'>mrim</a> or with <a href='https://rimstone-lang.com/silent-header.html'>silent-header</a>) simply omit this environment variable.<br/>
<br/>
<span style="font-weight:bold;">- Timeout</span><br/>
"timeout" is the number of seconds a call to the service should not exceed. For instance if the remote service is taking too long or if the network connection is too slow, you can limit how long to wait for a reply. If there is no timeout, then "timeout" value should be zero. Note that DNS resolution of the host name (in case you are using a TCP socket) is not counted in timeout. Maximum value for timeout is 86400.<br/>
<br/>
Even if timeout is set to 0, a service call may eventually timeout due to underlying socket and network settings. Note that even if your service call times out, the actual service executing may continue until it's done.<br/>
<span style="font-weight:bold;">- Thread ID</span><br/>
"thread_id" is an integer that you can set and use when your program is multithreaded. By default it's 0. This number is set by you and passed to hooks (your functions called when request is complete or data available). You can use this number to differentiate the data with regards to which thread it belongs to.<br/>
<br/>
<span style="font-weight:bold;">- Completion indicator and return code</span><br/>
When your program is multithreaded, it may be useful to know when (and if) a request has completed. "done" is set to "true" when a request completes, and "return_code" is the return value from rim_cli_request() (see below for a list). In a single-threaded program, this information is self-evident, but if you are running more than one request at the same time (in different threads), you can use these to check on each request executing in parallel (for instance in a loop in the main thread).<br/>
<br/>
Note that "done" is "true" specifically when all the results of a request are available and the request is about to be completed. In a multithreaded program, it means the thread is very soon to terminate or has already terminated; it does not mean that thread has positively terminated. Use standard "pthread_join()" function to make sure the thread has terminated if that is important to you. <br/>
<div class="vsub"><a id="Return value of rim_cli_request()"></a>Return value of rim_cli_request()</div>
The following are possible return values from "rim_cli_request()" (available in "return_code" member of "rim_cli" type):<br/>
<ul><li>RIM_OKAY if request succeeded,<br/>
</li><li>RIM_CLI_ERR_RESOLVE_ADDR if host name for TCP connection cannot be resolved,<br/>
</li><li>RIM_CLI_ERR_PATH_TOO_LONG if path name of Unix socket is too long,<br/>
</li><li>RIM_CLI_ERR_SOCKET if cannot create a socket (for instance they are exhausted for the process or system),<br/>
</li><li>RIM_CLI_ERR_CONNECT if cannot connect to server (TCP or Unix alike),<br/>
</li><li>RIM_CLI_ERR_SOCK_WRITE if cannot write data to server (for instance if server has encountered an error or is down, or if network connection is no longer available),<br/>
</li><li>RIM_CLI_ERR_SOCK_READ if cannot read data from server (for instance if server has encountered an error or is down, or if network connection is no longer available),<br/>
</li><li>RIM_CLI_ERR_PROT_ERR if there is a protocol error, which indicates a protocol issue on either or both sides,<br/>
</li><li>RIM_CLI_ERR_BAD_VER if either side does not support protocol used by the other,<br/>
</li><li>RIM_CLI_ERR_SRV if server cannot complete the request,<br/>
</li><li>RIM_CLI_ERR_UNK if server does not recognize record types used by the client,<br/>
</li><li>RIM_CLI_ERR_OUT_MEM if client is out of memory,<br/>
</li><li>RIM_CLI_ERR_ENV_TOO_LONG if the combined length of all environment variables is too long,<br/>
</li><li>RIM_CLI_ERR_ENV_ODD if the number of supplied environment name/value pairs is incorrect,<br/>
</li><li>RIM_CLI_ERR_BAD_TIMEOUT if the value for timeout is incorrect,<br/>
</li><li>RIM_CLI_ERR_TIMEOUT if the request timed out based on "timeout" parameter or otherwise if the underlying Operating System libraries declared their own timeout.</li></ul>
You can obtain the error message (corresponding to the above return values) in "errm" member of "rim_cli" type.<br/>
<div class="vsub"><a id="Server reply"></a>Server reply</div>
The service reply is split in two. One part is the actual result of processing (called "stdout" or standard output), and that is "data". The other is the error messages (called "stderr" or standard error), and that's "error". All of service output goes to "data", except from <a href='https://rimstone-lang.com/report-error.html'>report-error</a> and <a href='https://rimstone-lang.com/print-format.html'>print-format</a> (with "to-error" clause) which goes to "error". Note that "data" and "error" streams can be co-mingled when output by the service, but they will be obtained separately. This allows for clean separation of output from any error messages.<br/>
<br/>
You can obtain service reply when it's ready in its entirety (likely most often used), or as it comes alone bit by bit (see more about asynchronous hooks further here).<br/>
<div class="vsub"><a id="Status of request execution"></a>Status of request execution</div>
"req_status" member of "rim_cli" type is the request status when a request had executed; it is somewhat similar to an exit status of a program. A RimStone service request returns status by means of <a href='https://rimstone-lang.com/exit-status.html'>exit-status</a> statement. Note that "req_status" is valid only if "rim_cli_request()" returned RIM_OKAY (or if "return_code" is RIM_OKAY for multi-threaded programs).<br/>
<div class="vsub"><a id="Getting data reply (stdout)"></a>Getting data reply (stdout)</div>
Data returned from a request is valid only if "rim_cli_request()" returned RIM_OKAY (or if "return_code" is RIM_OKAY for multi-threaded programs). In that case, use "rim_cli_data()" function, for example:<br/>
<div class='code'  style='position:relative;padding-right:16px;'>
<pre id='code_477' class=notranslate>
<span class="Comment">// Declare and initialize request variable</span>
rim_cli req = {<span class="Constant">0</span>};
<span class="Comment">// Setup the req variable</span>
<span class="Statement">.</span>..
<span class="Comment">// Execute request</span>
<span class="Statement">if</span> (rim_cli_request (&amp;req) == RIM_OKAY) {
    <span class="Type">char</span> *data = rim_cli_data (req); <span class="Comment">// data response</span>
    <span class="Type">int</span> data_len = req-&gt;data_len; <span class="Comment">// length of data response in bytes</span>
<span class="Statement">}</span></pre>
<span id=rimstone_copied_477 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_477' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_477, code_477, rimstone_copied_477)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
"data_len" member of "rim_cli" type will have the length of data response in bytes. The reply is always null-terminated as a courtesy, and "data_len" does not include the terminating null byte.<br/>
<br/>
"rim_cli_data()" returns the actual response (i.e. data output) from service as passed to "data" stream. Any output from service will go there, except when "to-error" clause is used in <a href='https://rimstone-lang.com/print-format.html'>print-format</a> - use these constructs to output errors without stopping the service execution. Additionally, the output of <a href='https://rimstone-lang.com/report-error.html'>report-error</a> will also not go to data output.<br/>
<div class="vsub"><a id="Getting error reply (stderr)"></a>Getting error reply (stderr)</div>
An error reply returned from a service is valid only if "rim_cli_request()" returned RIM_OKAY (or if "return_code" is RIM_OKAY for multi-threaded programs). In that case, use "rim_cli_error()" function, for example:<br/>
<div class='code'  style='position:relative;padding-right:16px;'>
<pre id='code_478' class=notranslate>
<span class="Comment">// Declare and initialize request variable</span>
rim_cli req = {<span class="Constant">0</span>};
<span class="Comment">// Setup the req variable</span>
<span class="Statement">.</span>..
<span class="Comment">// Execute request</span>
<span class="Statement">if</span> (rim_cli_request (&amp;req) == RIM_OKAY) {
    <span class="Type">char</span> *err = rim_cli_error (req); <span class="Comment">// error response</span>
    <span class="Type">int</span> err_len = req-&gt;error_len; <span class="Comment">// length of error response in bytes</span>
<span class="Statement">}</span></pre>
<span id=rimstone_copied_478 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_478' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_478, code_478, rimstone_copied_478)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
"rim_cli_error()" returns any error messages from a service response, i.e. data passed to "error" stream. It is comprised of any service output when "to-error" clause is used in <a href='https://rimstone-lang.com/print-format.html'>print-format</a>, as well as any output from <a href='https://rimstone-lang.com/report-error.html'>report-error</a>. <br/>
<br/>
"error_len" member (of "rim_cli" type above) will have the length of error response in bytes. The response is always null-terminated as a courtesy, and "error_len" does not include the terminating null byte.<br/>
<div class="vsub"><a id="Freeing the result of a request"></a>Freeing the result of a request</div>
Once you have obtained the result of a request, and when no longer needed, you should free it by using "rim_cli_delete()":<br/>
<div class='code'  style='position:relative;padding-right:16px;'>
<pre id='code_479' class=notranslate>
<span class="Comment">// Declare and initialize request variable</span>
rim_cli req = {<span class="Constant">0</span>};
<span class="Comment">// Setup the req variable</span>
<span class="Statement">.</span>..
<span class="Comment">// Execute request</span>
rim_cli_request (&amp;req);
<span class="Comment">// .. Use the result ..</span>
<span class="Comment">// Free request output (data and error streams)</span>
rim_cli_delete (&amp;req);</pre>
<span id=rimstone_copied_479 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_479' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_479, code_479, rimstone_copied_479)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
If you do not free the result, your program may experience a memory leak. If your program exits right after issuing any request(s), you may skip freeing results as that is automatically done on exit by the Operating System. <br/>
<br/>
You can use "rim_cli_delete()" regardless of whether "rim_cli_request()" returned RIM_OKAY or not.<br/>
<div class="vsub"><a id="Completion hook"></a>Completion hook</div>
A function you wrote can be called when a request has completed. This is useful in multithreaded invocations, where you may want to receive complete request's results as they are available. To specify a completion hook, you must write a C function with the following signature and assign it to "done_hook" member of "rim_cli" typed variable:<br/>
<div class='code'  style='position:relative;padding-right:16px;'>
<pre id='code_453' class=notranslate>
<span class="Type">typedef</span> <span class="Type">void</span> (*rim_cli_done_hook)(<span class="Type">char</span> *recv, <span class="Type">int</span> recv_len, <span class="Type">char</span> *err, <span class="Type">int</span> err_len, rim_cli *req);</pre>
<span id=rimstone_copied_453 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_453' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_453, code_453, rimstone_copied_453)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
"recv" is the request's data output, "recv_len" is its length in bytes, "err" is the request's error output, and "err_len" is its length in bytes. "req" is the request itself which you can use to obtain any other information about the request. In a single threaded environment, these are available as members of the request variable of "rim_cli" type used in the request, and there is not much use for a completion hook. <br/>
<br/>
See an example with asynchronous hooks.<br/>
<div class="vsub"><a id="Asynchronous hooks"></a>Asynchronous hooks</div>
You can obtain the service's reply as it arrives by specifying read hooks. This is useful if the service supplies partial replies over a period of time, and your application can get those partial replies as they become available.<br/>
<br/>
To specify a hook for data output (i.e. from stdout), you must write a C function with the following signature and assign it to "out_hook":<br/>
<div class='code'  style='position:relative;padding-right:16px;'>
<pre id='code_454' class=notranslate>
<span class="Type">typedef</span> <span class="Type">void</span> (*rim_cli_out_hook)(<span class="Type">char</span> *recv, <span class="Type">int</span> recv_len, rim_cli *req);</pre>
<span id=rimstone_copied_454 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_454' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_454, code_454, rimstone_copied_454)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
"recv" is the data received and "recv_len" is its length.<br/>
<br/>
To specify a hook for error output (i.e. from stderr), you must write a C function with the following signature and assign it to "err_hook":<br/>
<div class='code'  style='position:relative;padding-right:16px;'>
<pre id='code_455' class=notranslate>
<span class="Type">typedef</span> <span class="Type">void</span> (*rim_cli_err_hook)(<span class="Type">char</span> *err, <span class="Type">int</span> err_len, rim_cli *req);</pre>
<span id=rimstone_copied_455 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_455' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_455, code_455, rimstone_copied_455)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
"err" is the error received and "err_len" is its length.<br/>
<br/>
"req" (in both hooks) is the request itself which you can use to obtain any other information about the request.<br/>
<br/>
To register these functions with "rim_cli_request()" function, assign their pointers to "out_hook" and "err_hook" members of request variable of type "rim_cli" respectively. Note that the output hook (i.e. hook function of type "rim_cli_out_hook") will receive empty string ("") in "recv" and "recv_len" will be 0 when the request has completed, meaning all service output (including error) has been received. <br/>
<br/>
For example, functions "get_output()" and "get_err()" will capture data as it arrives and print it out, and get_complete() will print the final result:<br/>
<div class='code'  style='position:relative;padding-right:16px;'>
<pre id='code_456' class=notranslate>
<span class="Comment">// Output hook</span>
<span class="Type">void</span> get_output(<span class="Type">char</span> *d, <span class="Type">int</span> l, rim_cli *req)
<span class="Statement">{</span>
    printf(<span class="Constant">&quot;Got output of [</span><span class="Special">%.*s</span><span class="Constant">] of length [</span><span class="Special">%d</span><span class="Constant">] in thread [</span><span class="Special">%d</span><span class="Constant">]&quot;</span>, l, d, l, req-&gt;thread_id);
<span class="Statement">}</span>

<span class="Comment">// Error hook</span>
<span class="Type">void</span> get_err(<span class="Type">char</span> *d, <span class="Type">int</span> l, rim_cli *req)
<span class="Statement">{</span>
    printf(<span class="Constant">&quot;Got error of [</span><span class="Special">%.*s</span><span class="Constant">] of length [</span><span class="Special">%d</span><span class="Constant">], status [</span><span class="Special">%d</span><span class="Constant">]&quot;</span>, l, d, l, req-&gt;req_status);
<span class="Statement">}</span>

<span class="Comment">// Completion hook</span>
<span class="Type">void</span> get_complete(<span class="Type">char</span> *data, <span class="Type">int</span> data_len, <span class="Type">char</span> *err, <span class="Type">int</span> err_len, rim_cli *req)
<span class="Statement">{</span>
    printf(<span class="Constant">&quot;Got data [</span><span class="Special">%.*s</span><span class="Constant">] of length [</span><span class="Special">%d</span><span class="Constant">] and error of [</span><span class="Special">%.*s</span><span class="Constant">] of length [</span><span class="Special">%d</span><span class="Constant">], status [</span><span class="Special">%d</span><span class="Constant">], thread [</span><span class="Special">%d</span><span class="Constant">]</span><span class="Special">\n</span><span class="Constant">&quot;</span>, data_len, data, data_len, err_len, err, err_len, req-&gt;req_status, req-&gt;thread_id);
<span class="Statement">}</span>

<span class="Statement">.</span>..

rim_cli req = {<span class="Constant">0</span>};
<span class="Statement">.</span>..
<span class="Comment">// Register output and error hooks, as well as a completion hook</span>
req.out_hook = &amp;get_output;
req.err_hook = &amp;get_err;
req.done_hook = &amp;get_complete;</pre>
<span id=rimstone_copied_456 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_456' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_456, code_456, rimstone_copied_456)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
<div class="vsub"><a id="Multithreading"></a>Multithreading</div>
The RimStone client is MT-safe, meaning you can use it both in single-threaded and multi-threaded programs. Note that each thread must have its own copy of "rim_cli" request variable, since it provides both input and output parameters to a request call and as such cannot be shared between the threads.<br/>
<div class="vsub"><a id="Usage"></a>Usage</div>
Do not use this API directly with RimStone - use <a href='https://rimstone-lang.com/call-remote.html'>call-remote</a> instead which is made specifically for use in .rim files. Otherwise, you can use this API with any client program.<br/>
<div class="vsub"><a id="Examples"></a>Examples</div>
<div class="vsub"><a id="Simple example"></a>Simple example</div>
The following example is a simple demonstration, with minimum of options used. Copy the C code to file "cli.c" in a directory of its own:<br/>
<div class='code'  style='position:relative;padding-right:16px;'>
<pre id='code_457' class=notranslate>
<span class="PreProc">#include </span><span class="Constant">&quot;rcli.h&quot;</span>

<span class="Type">void</span> main ()
<span class="Statement">{</span>
    <span class="Comment">// Request type rim_cli - create a request variable and zero it out</span>
    rim_cli req = {<span class="Constant">0</span>};

    <span class="Comment">// get socket file to communicate with server</span>
    <span class="Type">char</span> dir[RIM_MAX_OS_UDIR_LEN];
    rim_dir (RIM_DIR_SOCKFILE, dir, <span class="Statement">sizeof</span>(dir), <span class="Constant">&quot;helloworld&quot;</span>, <span class="Constant">NULL</span>);
    req.server = dir;

    req.req_method = <span class="Constant">&quot;GET&quot;</span>; <span class="Comment">// GET HTTP method</span>
    req.app_path = <span class="Constant">&quot;/helloworld&quot;</span>; <span class="Comment">// application path</span>
    req.req = <span class="Constant">&quot;/hello-simple&quot;</span>; <span class="Comment">// request name</span>

    <span class="Comment">// Make a request</span>
    <span class="Type">int</span> res = rim_cli_request (&amp;req);

    <span class="Comment">// Check return status, and if there's an error, display error code and the</span>
    <span class="Comment">// corresponding error message. Otherwise, print out service response.</span>
    <span class="Statement">if</span> (res != RIM_OKAY) printf(<span class="Constant">&quot;Request failed [</span><span class="Special">%d</span><span class="Constant">] [</span><span class="Special">%s</span><span class="Constant">]</span><span class="Special">\n</span><span class="Constant">&quot;</span>, res, req.errm);
    <span class="Statement">else</span> printf(<span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant">&quot;</span>, rim_cli_data(&amp;req));

    <span class="Comment">// Free up resources so there are no memory leaks</span>
    rim_cli_delete(&amp;req);
<span class="Statement">}</span></pre>
<span id=rimstone_copied_457 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_457' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_457, code_457, rimstone_copied_457)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
To make this client application:<br/>
<div class="shcode" style='position:relative;padding-right:16px;'>
<pre id='code_465' class=notranslate>
gcc <span class="Special">-o</span> cli cli.c <span class="PreProc">$(</span><span class="Special">rim </span><span class="Special">-i</span><span class="PreProc">)</span></pre>
<span id=rimstone_copied_465 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_465' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_465, code_465, rimstone_copied_465)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
In this case, you're using a Unix socket to communicate with the RimStone service. To test with a RimStone service handler, copy the following code to "hello_simple.rim" file in a separate directory:<br/>
<div class='code'  style='position:relative;padding-right:16px;'>
<pre id='code_458' class=notranslate>
<span class="Statement">begin-handler</span> /hello_simple<span class="Identifier"> public</span>
<span class="Statement">   silent-header</span>
<span class="Statement">   @</span>Hi there!
<span class="Statement">end-handler</span></pre>
<span id=rimstone_copied_458 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_458' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_458, code_458, rimstone_copied_458)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
Create and make the RimStone application and run it via local Unix socket:<br/>
<div class="shcode" style='position:relative;padding-right:16px;'>
<pre id='code_468' class=notranslate>
rim <span class="Special">-k</span> helloworld
rim <span class="Special">-q</span>
mrim <span class="Special">-m</span> quit helloworld
mrim <span class="Special">-w</span> <span class="Constant">1</span> helloworld</pre>
<span id=rimstone_copied_468 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_468' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_468, code_468, rimstone_copied_468)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
Run the client:<br/>
<div class="shcode" style='position:relative;padding-right:16px;'>
<pre id='code_470' class=notranslate>
./cli</pre>
<span id=rimstone_copied_470 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_470' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_470, code_470, rimstone_copied_470)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
The output is, as expected:<br/>
<div class='code'  style='position:relative;padding-right:16px;'>
<pre id='code_459' class=notranslate>
Hi there!</pre>
<span id=rimstone_copied_459 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_459' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_459, code_459, rimstone_copied_459)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
<div class="vsub"><a id="Example with more options"></a>Example with more options</div>
This example demonstrates using multiple options, including using TCP sockets connecting to a host and port number, environment variables, query string, request body and request execution timeout. It will also show the separation of "data" and "error" (i.e. stdout and stderr) streams from the service.<br/>
<br/>
Copy this to file "cli1.c" in a directory of its own - note that in this example a server will run on localhost (127.0.0.1) and TCP port 2301:<br/>
<div class='code'  style='position:relative;padding-right:16px;'>
<pre id='code_460' class=notranslate>
<span class="PreProc">#include </span><span class="Constant">&quot;rcli.h&quot;</span>

<span class="Type">void</span> main ()
<span class="Statement">{</span>
    <span class="Comment">// Request type rim_cli - create a request variable</span>
    rim_cli req;
    <span class="Comment">// Initialize request</span>
    memset (&amp;req, <span class="Constant">0</span>, <span class="Statement">sizeof</span>(req));

    <span class="Comment">// Add 3 environment variables (in the form of name, value, name, value, ... , NULL)</span>
    <span class="Type">char</span> *env[] = { <span class="Constant">&quot;REMOTE_USER&quot;</span>, <span class="Constant">&quot;John&quot;</span>, <span class="Constant">&quot;SOME_VAR&quot;</span>, <span class="Constant">&quot;SOME</span><span class="Special">\n</span><span class="Constant">VALUE&quot;</span>, <span class="Constant">&quot;NEW_VAR&quot;</span>, <span class="Constant">&quot;1000&quot;</span>, <span class="Constant">NULL</span> };

    <span class="Comment">// Create a request</span>
    <span class="Comment">// Environment variables to pass to service request</span>
    req.env = env;
    <span class="Comment">// Server IP and port</span>
    req.server = <span class="Constant">&quot;127.0.0.1:2301&quot;</span>;
    <span class="Comment">// Request method</span>
    req.req_method = <span class="Constant">&quot;GET&quot;</span>;
    <span class="Comment">// Application path</span>
    req.app_path = <span class="Constant">&quot;/helloworld&quot;</span>;
    <span class="Comment">// Request</span>
    req.req = <span class="Constant">&quot;/hello&quot;</span>;
    <span class="Comment">// URL parameters (path and query string)</span>
    req.url_params = <span class="Constant">&quot;par1=val1&amp;par2=91&quot;</span>;
    <span class="Comment">// Content type</span>
    req.content_type = <span class="Constant">&quot;application/json&quot;</span>;
    <span class="Comment">// Content (i.e. request body)</span>
    req.req_body = <span class="Constant">&quot;This is request body&quot;</span>;
    <span class="Comment">// Content length</span>
    req.content_len = strlen (req.req_body);
    <span class="Comment">// No timeout (set to 0)</span>
    req.timeout = <span class="Constant">0</span>;

    <span class="Comment">// Make a request</span>
    <span class="Type">int</span> res = rim_cli_request (&amp;req);

    <span class="Comment">// Check return status, and if there's an error, display error code and the</span>
    <span class="Comment">// corresponding error message</span>
    <span class="Statement">if</span> (res != RIM_OKAY) printf(<span class="Constant">&quot;Request failed [</span><span class="Special">%d</span><span class="Constant">] [</span><span class="Special">%s</span><span class="Constant">]</span><span class="Special">\n</span><span class="Constant">&quot;</span>, res, req.errm);
    <span class="Statement">else</span> {
       <span class="Comment">// If successful, display request results</span>
       <span class="Comment">// Exit code from the service processing</span>
       printf(<span class="Constant">&quot;Server status </span><span class="Special">%d</span><span class="Special">\n</span><span class="Constant">&quot;</span>, req.req_status);
       <span class="Comment">// Length of reply from service</span>
       printf(<span class="Constant">&quot;Len of data </span><span class="Special">%d</span><span class="Special">\n</span><span class="Constant">&quot;</span>, req.data_len);
       <span class="Comment">// Length of any error from service</span>
       printf(<span class="Constant">&quot;Len of error </span><span class="Special">%d</span><span class="Special">\n</span><span class="Constant">&quot;</span>, req.error_len);
       <span class="Comment">// Reply from service</span>
       printf(<span class="Constant">&quot;Data [</span><span class="Special">%s</span><span class="Constant">]</span><span class="Special">\n</span><span class="Constant">&quot;</span>, rim_cli_data(&amp;req));
       <span class="Comment">// Any error message from service</span>
       printf(<span class="Constant">&quot;Error [</span><span class="Special">%s</span><span class="Constant">]</span><span class="Special">\n</span><span class="Constant">&quot;</span>, rim_cli_error(&amp;req));
<span class="Statement">    }</span>

    <span class="Comment">// Free up resources so there are no memory leaks</span>
    rim_cli_delete(&amp;req);
<span class="Statement">}</span></pre>
<span id=rimstone_copied_460 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_460' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_460, code_460, rimstone_copied_460)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
Note that the URL parameters (i.e. "req.url_params") could have been written as a combination of a path segment and query string (see <a href='https://rimstone-lang.com/request.html'>request</a>):<br/>
<div class='code'  style='position:relative;padding-right:16px;'>
<pre id='code_461' class=notranslate>
req.url_params = <span class="Constant">&quot;/par1/val1?par2=91&quot;</span>;</pre>
<span id=rimstone_copied_461 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_461' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_461, code_461, rimstone_copied_461)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
or just as a path segment:<br/>
<div class='code'  style='position:relative;padding-right:16px;'>
<pre id='code_462' class=notranslate>
req.url_params = <span class="Constant">&quot;/par1=val1/par2=91&quot;</span>;</pre>
<span id=rimstone_copied_462 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_462' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_462, code_462, rimstone_copied_462)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
To make this client application:<br/>
<div class="shcode" style='position:relative;padding-right:16px;'>
<pre id='code_472' class=notranslate>
gcc <span class="Special">-o</span> cli1 cli1.c <span class="PreProc">$(</span><span class="Special">rim </span><span class="Special">-i</span><span class="PreProc">)</span></pre>
<span id=rimstone_copied_472 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_472' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_472, code_472, rimstone_copied_472)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
To test it, you can create a RimStone application. Copy this to "hello.rim" file in a separate directory:<br/>
<div class='code'  style='position:relative;padding-right:16px;'>
<pre id='code_466' class=notranslate>
<span class="Statement">begin-handler</span> /hello<span class="Identifier"> public</span>
<span class="Statement">    silent-header</span>

    <span class="Comment">// Get request body</span>
<span class="Statement">    request-body</span> rb

    <span class="Comment">// Input params</span>
<span class="Statement">    get-param</span> par1
<span class="Statement">    get-param</span> par2

    <span class="Comment">// Get environment variables passed on from the client</span>
<span class="Statement">    get-sys</span><span class="Identifier"> environment</span> <span class="Constant">&quot;REMOTE_USER&quot;</span><span class="Type"> to</span> ruser
<span class="Statement">    get-sys</span><span class="Identifier"> environment</span> <span class="Constant">&quot;SOME_VAR&quot;</span><span class="Type"> to</span> somev
<span class="Statement">    get-sys</span><span class="Identifier"> environment</span> <span class="Constant">&quot;NEW_VAR&quot;</span><span class="Type"> to</span> newv

    <span class="Comment">// Output, print the environment variables, the PID of server process and the request body received from the client</span>
<span class="Statement">    get-req</span><span class="Identifier"> process-id</span><span class="Type"> to</span> pid
<span class="Statement">    @</span>Hello World! [<span class="Statement">&lt;&lt;print-out</span> ruser<span class="Statement">&gt;&gt;</span>] [<span class="Statement">&lt;&lt;print-out</span> somev<span class="Statement">&gt;&gt;</span>] [<span class="Statement">&lt;&lt;print-out</span> newv<span class="Statement">&gt;&gt;</span>] [<span class="Statement">&lt;&lt;print-out</span> par1<span class="Statement">&gt;&gt;</span>] [<span class="Statement">&lt;&lt;print-out</span> par2<span class="Statement">&gt;&gt;</span>] <span class="Statement">&lt;&lt;print-out</span> pid<span class="Statement">&gt;&gt;</span> <span class="Statement">&lt;&lt;print-out</span> rb<span class="Statement">&gt;&gt;</span>

    <span class="Comment">// Output back a number of lines, generally as &quot;Output line #&lt;num of line&gt;&quot;</span>
    <span class="Comment">// After line #1418, print out &quot;Line 1419 has an error&quot; to stderr</span>
    <span class="Comment">// After line #4418, report an error and exit</span>
    <span class="Comment">// This demonstrates outputting data to both stdout and stderr</span>
<span class="Statement">    start-loop</span><span class="Identifier"> repeat</span> <span class="Constant">8000</span><span class="Type"> use</span> i<span class="Identifier"> start-with</span> <span class="Constant">0</span>
<span class="Statement">        @</span>Output line #<span class="Statement">&lt;&lt;print-out</span> i<span class="Statement">&gt;&gt;</span>
<span class="Statement">        if-true</span> i<span class="Identifier"> equal</span> <span class="Constant">1419</span>
<span class="Statement">            print-format</span> <span class="Constant">&quot;Line </span><span class="Special">%ld</span><span class="Constant"> has an error</span><span class="Special">\n</span><span class="Constant">&quot;</span>, i<span class="Identifier"> to-error</span>
<span class="Statement">        end-if</span>
<span class="Statement">        if-true</span> i<span class="Identifier"> equal</span> <span class="Constant">4419</span>
            <span class="Comment">// Exit code of the service execution</span>
<span class="Statement">            exit-status</span> <span class="Constant">82</span>
<span class="Statement">            report-error</span> <span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant">&quot;</span>, <span class="Constant">&quot;Some error!&quot;</span>
<span class="Statement">        end-if</span>
<span class="Statement">    end-loop</span>
<span class="Statement">end-handler</span></pre>
<span id=rimstone_copied_466 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_466' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_466, code_466, rimstone_copied_466)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
Create and make the RimStone application and run it on local TCP port 2301 to match the client above:<br/>
<div class="shcode" style='position:relative;padding-right:16px;'>
<pre id='code_474' class=notranslate>
rim <span class="Special">-k</span> helloworld
rim <span class="Special">-q</span>
mrim <span class="Special">-m</span> quit helloworld
mrim <span class="Special">-w</span> <span class="Constant">1</span> <span class="Special">-p</span> <span class="Constant">2301</span> helloworld</pre>
<span id=rimstone_copied_474 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_474' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_474, code_474, rimstone_copied_474)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
Run the client:<br/>
<div class="shcode" style='position:relative;padding-right:16px;'>
<pre id='code_476' class=notranslate>
./cli1</pre>
<span id=rimstone_copied_476 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_476' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_476, code_476, rimstone_copied_476)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
The output:<br/>
<div class='ncode' style='position:relative;padding-right:16px;'>
<pre id='code_463' class=notranslate>
Server status 82
Len of data 78530
Len of error 35
Data [Hello World! [John] [SOME
VALUE] [1000] [val1] [91] 263002 This is request body
Output line #0
Output line #1
Output line #2
Output line #3
Output line #4
Output line #5
Output line #6
Output line #7

...
Output line #4413
Output line #4414
Output line #4415
Output line #4416
Output line #4417
Output line #4418
Output line #4419
]
Error [Line 1419 has an error
Some error!
]</pre>
<span id=rimstone_copied_463 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_463' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_463, code_463, rimstone_copied_463)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
The output shows service exit code (82, see <a href='https://rimstone-lang.com/exit-status.html'>exit-status</a> in the RimStone code above), length of data output, and other information which includes environment variables passed to the service from the client, the PID of server process, the request body from the client, and then the error output. Note that the data output (stdout) and the error output (stderr) are separated, since the protocol does use separate streams over the same connection. This makes working with the output easy, while the data transfer is fast at the same time.<br/>
<div class="vsub"><a id="See also"></a>See also</div>
 <a name='API'></a><span style="font-weight:bold;">API</span><br/>
<a href='https://rimstone-lang.com/Client-API.html'>Client-API</a> &nbsp;<br/>
<a href='https://rimstone-lang.com/Client-API-and-messaging.html'>Client-API-and-messaging</a> &nbsp;<br/>
<a href='https://rimstone-lang.com/Server-API.html'>Server-API</a> &nbsp; <br/>
<span style="font-weight:bold;">See all</span> <br/>
<a href='https://rimstone-lang.com/documentation.html'>documentation</a><br/>
<!--ENDVDOC90-->
<br/><div style='width:100%;clear:both;'>
<hr/>
<!--GOLFFOOT77--><span style='font-size:80%'><a href="https://rimstone-lang.com/copyright.html">Copyright</a> (c) 2019-2025 Gliim LLC. All contents on this web site is "AS IS" without warranties or guarantees of any kind.</span>
</div><br/></body></html>


