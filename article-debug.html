<!DOCTYPE html>
<html lang="en">

<head>
<!--__RIM_REDIRECT__-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">

<title>How to debug RimStone programs with gdb</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="HandheldFriendly" content="True"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="canonical" href="https://rimstone-lang.com/article-debug.html" />
<style>


body, html {
    font-family: Quicksand,monospace,Helvetica, Arial, sans-serif;
    line-height: 150%;
    font-size:16px;
}

body {
    padding-left:1vw;
    padding-right:1vw;
}
    
.ncode {
    letter-spacing: 0px;
    font-family: monospace;
    font-size:83%;
    display:inline-block;
    max-width:99%;
    min-width:90%;
    margin:0;
    padding:0;
    padding-left:5px;
    padding-top:3px;
    padding-bottom:3px;
    margin-bottom:8px;
    margin-top:8px;
    border: 2px solid #d6d6d6;
    background-color:#f5f7f4;
    white-space:nowrap;
}

.shcode {
    letter-spacing: 0px;
    font-family: monospace;
    font-size:83%;
    display:inline-block;
    max-width:99%;
    min-width:90%;
    margin:0;
    padding:0;
    padding-left:5px;
    padding-top:3px;
    padding-bottom:3px;
    margin-bottom:8px;
    margin-top:8px;
    border: 2px solid #d6d6d6;
    background-color:#f5f7f4;
    white-space:nowrap;
}

.sqlcode {
    letter-spacing: 0px;
    font-family: monospace;
    font-size:83%;
    display:inline-block;
    max-width:99%;
    min-width:90%;
    margin:0;
    padding:0;
    padding-left:5px;
    padding-top:3px;
    padding-bottom:3px;
    margin-bottom:8px;
    margin-top:8px;
    border: 2px solid #d6d6d6;
    background-color:#f5f7f4;
    white-space:nowrap;
}

.htmlcode {
    letter-spacing: 0px;
    font-family: monospace;
    font-size:83%;
    display:inline-block;
    max-width:99%;
    min-width:90%;
    margin:0;
    padding:0;
    padding-left:5px;
    padding-top:3px;
    padding-bottom:3px;
    margin-bottom:8px;
    margin-top:8px;
    border: 2px solid #d6d6d6;
    background-color:#f5f7f4;
    white-space:nowrap;
}

.code {
    letter-spacing: 0px;
    font-family: monospace;
    font-size:83%;
    display:inline-block;
    max-width:99%;
    min-width:90%;
    margin:0;
    padding:0;
    padding-left:5px;
    padding-top:3px;
    padding-bottom:3px;
    margin-bottom:8px;
    margin-top:8px;
    border: 2px solid #d6d6d6;
    background-color:#f5f7f4;
    white-space:nowrap;
}

/*Just like h1 but for pdf conversion it would be indented this way it's not*/
.vhub {
    display: block;
   font-size: 1.6em;
   margin-top: 0.63em;
   margin-bottom: 0.63em;
   margin-left: 0;
   margin-right: 0;
   font-weight: bold;
}

/*Just like h2 but for pdf conversion it would be indented this way it's not*/
.vsub {
    display: block;
   font-size: 1.25em;
   margin-top: 0.53em;
   margin-bottom: 0.53em;
   margin-left: 0;
   margin-right: 0;
   font-weight: bold;
}

ul {
  margin-left: 0.75vw;
  padding-left: 0;
}
li {
  margin-left: 0.75vw;
  padding-left: 0;
}

/* this must be last, as it overrides previous settings, for mobile */
@media (hover: none) {
a {
   display: inline-block;
   padding-top: 3px;
   padding-bottom: 2px;
}
body {
    padding-left:2vw;
    padding-right:2vw;
    letter-spacing: 1px;
}
}

/*The following is for code snippets that are highlighted by 2html vim*/
pre { overflow-x: scroll; margin:0; padding:0; font-family:monospace; }
.Identifier { color: #008b8b; }
.Statement { color: #af5f00; }
.PreProc { color: #5fd7ff; }
.Type { color: #005f00; }
.Comment { color: blue ; }
.Constant { color: #ff00ff; }
/*end of highlighted snippets*/

a {
    text-decoration:none;
    padding-bottom: 0px; 
    color:inherit;
    border-bottom: 2px solid #6cb8f0;
}
a:hover {
    text-decoration: none;
    color:black;
    border-bottom: 1px solid red;
}
/*do not underline links nor should they be active*/
pre a {
    text-decoration:none;
    color:black;
    border-bottom: none;
    pointer-events: none;
    cursor: default;
}


.golfSnippet {display:none;}

ul {
  list-style-type:square;
  list-style-position: outside;
}

</style>


</head>
<body>
<div id="google_translate_element" style='float:right'></div>
<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
<script>
function rim_copy(gt, eid, gc) {
  gt.textContent = eid.textContent;
  gt.select();
  document.execCommand("copy");
  gc.style.visibility="visible"
  setTimeout(()=>{ gc.style.visibility="hidden"; }, 1000);
}
function googleTranslateElementInit() {
   new google.translate.TranslateElement({pageLanguage: 'en'}, 'google_translate_element');
}

</script>

<!--RIMMENU13-->

<!--RIMENDMENU13-->



<!--BEGVDOC90-->
<div class='vhub' style='margin-top:10px;margin-right:20px;text-align:left;background-color:white;'><a href='https://rimstone-lang.com' style='border-bottom:0px'><img src='https://rimstone-lang.com/rimstone.png' style='width:180px;height:auto'/></a></div><div class='vhub' style='margin-top:10px;'>How to debug RimStone programs with gdb</div><hr/><br/>
Debugging information is always included regardless of how you make your application; what varies is the amount of debugging info included. You can compile your RimStone application normally:<br/>
<div class="shcode" style='position:relative;padding-right:16px;'>
<pre id='code_49' class=notranslate>
rim <span class="Special">-q</span></pre>
<span id=rimstone_copied_49 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_49' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_49, code_49, rimstone_copied_49)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
This will create an executable that can be debugged with gdb. You can debug your RimStone program with gdb just as if it were a plain C program, which technically it is. This makes it much easier to get to the bottom of any issue directly without having to deal with virtual machines, p-code translation, assembler etc.<br/>
<br/>
For this reason, the debugging ecosystem for RimStone programs is already fully developed. For instance you can use Valgrind or Google ASAN with RimStone programs just as you'd with a C program.<br/>
<br/>
Note that in order to debug the RimStone itself, it's best to be compiled from source, or you need to use the included debugging information (meaning you need to install a debug package). This will be covered in another article here on RimStone blog.<br/>
<div class="vsub"><a id="Example"></a>Example</div>
Here's an example of debugging using RimStone. We'll create a little parsing application to illustrate.<br/>
<br/>
First, let's create a directory for our application "split" (since you'll be splitting a URL query string into name/value pairs):<br/>
<div class="shcode" style='position:relative;padding-right:16px;'>
<pre id='code_51' class=notranslate>
<span class="Statement">mkdir</span> split
<span class="Statement">cd</span> split
rim <span class="Special">-k</span> split</pre>
<span id=rimstone_copied_51 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_51' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_51, code_51, rimstone_copied_51)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
Create a source file "parse.rim" and copy this:<br/>
<div class='code'  style='position:relative;padding-right:16px;'>
<pre id='code_48' class=notranslate>
<span class="Statement">begin-handler</span> /parse
<span class="Statement">    silent-header</span>
<span class="Statement">    set-string</span> str = <span class="Constant">&quot;a=1&amp;b=2&amp;c=3&quot;</span>
    <span class="Comment">// Split string using &quot;&amp;&quot; as a delimiter</span>
<span class="Statement">    split-string</span> str<span class="Identifier"> with</span> <span class="Constant">&quot;&amp;&quot;</span><span class="Type"> to</span> pair<span class="Type"> count</span> pair_tot
<span class="Statement">    start-loop</span><span class="Identifier"> repeat</span> pair_tot<span class="Type"> use</span> pair_count
<span class="Statement">        read-split</span> pair_count<span class="Identifier"> from</span> pair<span class="Type"> to</span> item
        <span class="Comment">// Now split each item using &quot;=&quot; as a delimiter</span>
<span class="Statement">        split-string</span> item<span class="Identifier"> with</span> <span class="Constant">&quot;=&quot;</span><span class="Type"> to</span> equal
<span class="Statement">        read-split</span> <span class="Constant">1</span><span class="Identifier"> from</span> equal<span class="Type"> to</span> name
<span class="Statement">        read-split</span> <span class="Constant">2</span><span class="Identifier"> from</span> equal<span class="Type"> to</span> value
        <span class="Comment">// Output each name/value</span>
<span class="Statement">        print-format</span> <span class="Constant">&quot;Name [</span><span class="Special">%s</span><span class="Constant">] value [</span><span class="Special">%s</span><span class="Constant">]</span><span class="Special">\n</span><span class="Constant">&quot;</span>, name, value
<span class="Statement">    end-loop</span>
<span class="Statement">end-handler</span></pre>
<span id=rimstone_copied_48 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_48' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_48, code_48, rimstone_copied_48)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
<br/>
This program will parse the string "a=1&amp;b=2&amp;c=3" to produce name/value pairs - this is obviously a parsing of URL query string. It uses split-string statement which will split the string based on some delimiter string, and then you use read-split statement to get the split pieces one by one. Very simple.<br/>
<br/>
Compile and link this:<br/>
<div class="shcode" style='position:relative;padding-right:16px;'>
<pre id='code_53' class=notranslate>
rim <span class="Special">-q</span> <span class="Special">--public</span></pre>
<span id=rimstone_copied_53 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_53' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_53, code_53, rimstone_copied_53)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
<br/>
What's what here? First of all "-q" will make your project (meaning compile and link it, both command-line executable and application server), while "--public" makes all handlers public, meaning they can handle external requests (i.e. those from a caller outside your application).<br/>
<div class="vsub"><a id="Debugging"></a>Debugging</div>
Okay so now to execute this with gdb, do this:<br/>
<div class="shcode" style='position:relative;padding-right:16px;'>
<pre id='code_55' class=notranslate>
rim <span class="Special">-r</span> <span class="Special">--req</span><span class="Statement">=</span><span class="Statement">&quot;</span><span class="Constant">/parse</span><span class="Statement">&quot;</span></pre>
<span id=rimstone_copied_55 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_55' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_55, code_55, rimstone_copied_55)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
This will produce something like the following (substitute "your-user" for your OS user name):<br/>
<div class="shcode" style='position:relative;padding-right:16px;'>
<pre id='code_56' class=notranslate>
<span class="Statement">export</span> <span class="Identifier">CONTENT_TYPE</span>=
<span class="Statement">export</span> <span class="Identifier">CONTENT_LENGTH</span>=
<span class="Statement">unset</span><span class="Identifier"> RIM_SILENT_HEADER</span>
<span class="Statement">export</span> RIM_SILENT_HEADER
<span class="Statement">export</span> <span class="Identifier">REQUEST_METHOD</span>=GET
<span class="Statement">export</span> <span class="Identifier">SCRIPT_NAME</span>=<span class="Statement">&quot;</span><span class="Constant">/split</span><span class="Statement">&quot;</span>
<span class="Statement">export</span> <span class="Identifier">PATH_INFO</span>=<span class="Statement">&quot;</span><span class="Constant">/parse</span><span class="Statement">&quot;</span>
<span class="Statement">export</span> <span class="Identifier">QUERY_STRING</span>=<span class="Statement">&quot;&quot;</span>
/home/your-user/.rimstone/apps/split/.bld/split</pre>
<span id=rimstone_copied_56 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_56' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_56, code_56, rimstone_copied_56)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
This is basically setting the necessary environment variables and then executing the "split" program (specified here in full path). Remember, RimStone program can execute exactly the same as a web application server as well as command-line executable; hence the web environment variables need to be set.<br/>
<br/>
So if you copy and paste the above into bash shell, you'll get:<br/>
<div class='ncode' style='position:relative;padding-right:16px;'>
<pre id='code_47' class=notranslate>
Name [a] value [1]
Name [b] value [2]
Name [c] value [3]</pre>
<span id=rimstone_copied_47 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_47' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_47, code_47, rimstone_copied_47)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
Which is the proper parsing of the string. Okay so far so good.<br/>
<br/>
Now to debug your program, do:<br/>
<div class="shcode" style='position:relative;padding-right:16px;'>
<pre id='code_57' class=notranslate>
gdb /home/your-user/.rimstone/apps/split/.bld/split</pre>
<span id=rimstone_copied_57 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_57' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_57, code_57, rimstone_copied_57)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
You are now in gdb debugging shell:<br/>
<div class='ncode' style='position:relative;padding-right:16px;'>
<pre id='code_50' class=notranslate>
GNU gdb (Ubuntu 15.0.50.20240403-0ubuntu1) 15.0.50.20240403-git
Copyright (C) 2024 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Type &quot;show copying&quot; and &quot;show warranty&quot; for details.
This GDB was configured as &quot;x86_64-linux-gnu&quot;.
Type &quot;show configuration&quot; for configuration details.
For bug reporting instructions, please see:
&lt;https://www.gnu.org/software/gdb/bugs/&gt;.
Find the GDB manual and other documentation resources online at:
    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.

For help, type &quot;help&quot;.
Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;...
Reading symbols from /home/your-user/.rimstone/apps/split/.bld/split...
(gdb)</pre>
<span id=rimstone_copied_50 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_50' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_50, code_50, rimstone_copied_50)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
Now you can use standard gdb commands. We'll set a break in our code above (which is handler "parse"), and then run the program. Next we'll simply execute one statement at a time, and then we'll print the loop variable:<br/>
<div class='ncode' style='position:relative;padding-right:16px;'>
<pre id='code_52' class=notranslate>
(gdb) br parse
Breakpoint 1 at 0x3a5e: file /home/user/.rimstone/apps/split/.bld/__parse.o.c, line 4.
(gdb) run
Starting program: /home/your-user/.rimstone/apps/split/.bld/split
[Thread debugging using libthread_db enabled]
Using host libthread_db library &quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;.

Breakpoint 1.1, parse () at /home/your-user/tmp/test/split/parse.rim:1
4	void parse () {
(gdb) next
2	    silent-header
(gdb)
3	    set-string str = &quot;a=1&amp;b=2&amp;c=3&quot;
(gdb)
4	    split-string str with &quot;&amp;&quot; to pair count pair_tot
(gdb)
5	    start-loop repeat pair_tot use pair_count
(gdb)
6	        read-split pair_count from pair to item
(gdb)
5	    start-loop repeat pair_tot use pair_count
(gdb)
6	        read-split pair_count from pair to item
(gdb)
7	        split-string item with &quot;=&quot; to equal
(gdb)
8	        read-split 1 from equal to name
(gdb)
9	        read-split 2 from equal to value
(gdb)
11	        print-format &quot;Name [%s] value [%s]\n&quot;, name, value
(gdb)
Name [a] value [1]
6	        read-split pair_count from pair to item
(gdb) print pair_count
$1 = 1</pre>
<span id=rimstone_copied_52 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_52' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_52, code_52, rimstone_copied_52)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
As you can see, you're stepping through your RimStone program, with the code showing exactly as it is in your source file! You can do here anything that you can in a C program, for instance set breakpoints, conditions etc. In this case we also print the value of variable pair_count.<br/>
<br/>
gdb is too powerful to summarize here. There are many tutorials on the web. But suffice it to say you can easily debug your programs and see how they work step by step and a lot more (that's an understatement!).<br/>
<br/>
Finally, if you're so inclined, you can also step through generated C code and see exactly what makes your program tick. To do that, make your program with "--c-lines" flag, which lets you do that:<br/>
<div class="shcode" style='position:relative;padding-right:16px;'>
<pre id='code_58' class=notranslate>
rim <span class="Special">-q</span> <span class="Special">--public</span> <span class="Special">--c-lines</span></pre>
<span id=rimstone_copied_58 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_58' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_58, code_58, rimstone_copied_58)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
Now, repeat the above to get into gdb, and it may look like this (note that generated code can always change and there's absolutely no guarantee it will stay the same!):<br/>
<div class='ncode' style='position:relative;padding-right:16px;'>
<pre id='code_54' class=notranslate>
Breakpoint 1.1, parse () at /home/your-user/.rimstone/apps/split/.bld/__parse.o.c:4
4	void parse () {
(gdb) next
7	rim_get_config ()-&gt;ctx.req-&gt;silent=1;
(gdb) n
10	char *str = RIM_EMPTY_STRING;
(gdb)
17	if (_rim_gstr_once0) {
(gdb)
18	rim_gstr_ret0 = rim_mem_add_const (_rim_gstr0, sizeof(_rim_gstr0)-RIM_ALIGN);
(gdb)
19	_rim_gstr_once0 = false;
(gdb)
21	str = rim_gstr_ret0;
(gdb)
22	rim_mem_add_ref (rim_gstr_ret0);
(gdb)
29	if (_rim_gstr_once1) {
(gdb)
30	rim_gstr_ret1 = rim_mem_add_const (_rim_gstr1, sizeof(_rim_gstr1)-RIM_ALIGN);
(gdb)
31	_rim_gstr_once1 = false;
(gdb)
33	rim_split_str *pair = NULL;
(gdb)
34	rim_num pair_tot = 0;
(gdb)
35	rim_break_down (str, rim_gstr_ret1, &amp;(pair));
(gdb)
36	pair_tot= (pair)-&gt;num_pieces;
(gdb)
39	rim_num pair_count = 0;
(gdb)</pre>
<span id=rimstone_copied_54 style='position:absolute;right:-14px;top:-30px; cursor: pointer;visibility:hidden;background:white;'>Copied!</span>
<textarea id='rimstonet_54' style='position: absolute;left: -500%;'></textarea>
<img src='https://rimstone-lang.com/rimstone-copy-small-1.png' id='rimstoneb' onclick='rim_copy(rimstonet_54, code_54, rimstone_copied_54)' style='position:absolute;right:0;top:0; cursor: pointer;opacity:0.5;'/>
</div><br/>
This is literally the C code that runs your program. It doesn't look as user friendly for sure, but it's useful if you'd like to see what exactly takes place. It's also useful in debugging your program and RimStone as well.<br/>
<br/>
Now you know how to debug your RimStone programs with gdb.<br/>
<!--ENDVDOC90-->
<br/><div style='width:100%;clear:both;'>
<hr/>
<!--GOLFFOOT77--><span style='font-size:80%'><a href="https://rimstone-lang.com/copyright.html">Copyright</a> (c) 2019-2025 Gliim LLC. All contents on this web site is "AS IS" without warranties or guarantees of any kind.</span>
</div><br/></body></html>


